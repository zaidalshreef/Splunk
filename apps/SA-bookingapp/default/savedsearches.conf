#
# Saved Searches and Alerts for BookingApp
#

# =============================================================================
# NestJS API Alerts
# =============================================================================
[BookingApp - High Error Rate]
search = index=apps sourcetype=nestjs:json level=error earliest=-5m | stats count as errors | where errors > 50
alert.severity = 4
alert.suppress = 1
alert.suppress.period = 15m
cron_schedule = */5 * * * *
enableSched = 1
description = Triggers when NestJS API has more than 50 errors in 5 minutes

[BookingApp - Slow API Response]
search = index=apps sourcetype=nestjs:json duration>5000 earliest=-5m | stats count as slow_requests, avg(duration) as avg_duration | where slow_requests > 10
alert.severity = 3
cron_schedule = */5 * * * *
enableSched = 1
description = Triggers when API responses exceed 5 seconds

[BookingApp - Database Connection Issues]
search = index=apps sourcetype=postgresql:log (ERROR OR connection OR timeout) earliest=-5m | stats count | where count > 5
alert.severity = 4
cron_schedule = */5 * * * *
enableSched = 1
description = Triggers on PostgreSQL connection issues

[BookingApp - Redis Memory Warning]
search = index=apps sourcetype=redis:log (OOM OR "maxmemory" OR "evict") earliest=-15m | stats count | where count > 0
alert.severity = 3
cron_schedule = */15 * * * *
enableSched = 1
description = Triggers when Redis memory issues detected

# =============================================================================
# Reporting Searches
# =============================================================================
[BookingApp - Daily Error Summary]
search = index=apps sourcetype=nestjs:json level=error earliest=-24h | stats count by context, error_message | sort -count | head 20
cron_schedule = 0 8 * * *
enableSched = 1
action.email = 1
action.email.to = devops@example.com
description = Daily summary of API errors

[BookingApp - API Performance Report]
search = index=apps sourcetype=nestjs:json duration>0 earliest=-24h | stats avg(duration) as avg_ms, p95(duration) as p95_ms, p99(duration) as p99_ms, count by url | sort -count
cron_schedule = 0 9 * * *
enableSched = 1
description = Daily API performance statistics

[BookingApp - User Activity Report]
search = index=apps sourcetype=nestjs:json user_id=* earliest=-24h | stats dc(user_id) as unique_users, count as total_requests | eval requests_per_user=round(total_requests/unique_users,2)
cron_schedule = 0 7 * * *
enableSched = 1
description = Daily user activity summary

