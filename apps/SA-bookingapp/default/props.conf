#
# Props.conf - BookingApp Field Extractions
#

# =============================================================================
# NestJS JSON Logs (Winston/Pino format)
# =============================================================================
[nestjs:json]
KV_MODE = json
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3NZ
TIME_PREFIX = "timestamp":"
MAX_TIMESTAMP_LOOKAHEAD = 30
TRUNCATE = 0

# Extract common NestJS log fields
EXTRACT-level = "level":"(?<level>[^"]+)"
EXTRACT-context = "context":"(?<context>[^"]+)"
EXTRACT-message = "message":"(?<message>[^"]+)"
EXTRACT-request_id = "requestId":"(?<request_id>[^"]+)"
EXTRACT-trace_id = "traceId":"(?<trace_id>[^"]+)"
EXTRACT-user_id = "userId":"(?<user_id>[^"]+)"
EXTRACT-duration = "duration":(?<duration>\d+)
EXTRACT-method = "method":"(?<http_method>[^"]+)"
EXTRACT-url = "url":"(?<url>[^"]+)"
EXTRACT-status = "statusCode":(?<status_code>\d+)

# Error extraction
EXTRACT-error_name = "error":\{[^}]*"name":"(?<error_name>[^"]+)"
EXTRACT-error_message = "error":\{[^}]*"message":"(?<error_message>[^"]+)"
EXTRACT-stack_trace = "stack":"(?<stack_trace>[^"]+)"

# =============================================================================
# NextJS Logs
# =============================================================================
[nextjs:log]
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3NZ
MAX_TIMESTAMP_LOOKAHEAD = 30

# Extract route and rendering info
EXTRACT-route = GET\s+(?<route>\/[^\s]+)
EXTRACT-render_time = (?<render_time>\d+)ms
EXTRACT-page = Page:\s+(?<page>[^\s]+)

# =============================================================================
# PostgreSQL Logs
# =============================================================================
[postgresql:log]
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%d %H:%M:%S
TIME_PREFIX = ^

# Extract query info
EXTRACT-pg_duration = duration:\s+(?<pg_duration>[\d.]+)\s+ms
EXTRACT-pg_statement = statement:\s+(?<pg_statement>.+)
EXTRACT-pg_error = ERROR:\s+(?<pg_error>.+)
EXTRACT-pg_user = user=(?<pg_user>\w+)
EXTRACT-pg_database = database=(?<pg_database>\w+)
EXTRACT-pg_connection = connection\s+(?<pg_action>received|authorized|disconnection)

# =============================================================================
# Redis Logs
# =============================================================================
[redis:log]
SHOULD_LINEMERGE = false
TIME_FORMAT = %d %b %Y %H:%M:%S

EXTRACT-redis_level = ^\d+:\w+\s+\d+\s+\w+\s+\d+\s+[\d:]+\.\d+\s+(?<redis_level>\*|\#|\-)
EXTRACT-redis_message = ^\d+:\w+\s+\d+\s+\w+\s+\d+\s+[\d:]+\.\d+\s+[\*\#\-]\s+(?<redis_message>.+)
EXTRACT-redis_client = Client\s+(?<redis_client_ip>\d+\.\d+\.\d+\.\d+):(?<redis_client_port>\d+)

# =============================================================================
# BookingApp Metrics (JSON format)
# =============================================================================
[bookingapp:metrics]
KV_MODE = json
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%SZ
TIME_PREFIX = "timestamp":"

