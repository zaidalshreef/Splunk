<form version="1.1" theme="dark">
    <label>APM OVERVIEW</label>
    <description>Real-time Application Performance Monitoring - Service Health - Error Analysis</description>

    <fieldset submitButton="false" autoRun="true">
        <input type="time" token="time" searchWhenChanged="true">
            <label>TIME RANGE</label>
            <default>
                <earliest>-1h</earliest>
                <latest>now</latest>
            </default>
        </input>
    </fieldset>

    <!-- ============================================================ -->
    <!-- SECTION 1: SERVICE HEALTH AT A GLANCE (RED Metrics + Apdex) -->
    <!-- ============================================================ -->
    <row>
        <html>
            <style>
                .health-header { 
                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                    padding: 15px 20px;
                    border-radius: 8px;
                    margin-bottom: 10px;
                }
                .health-header h2 { 
                    color: #00D1B2; 
                    margin: 0; 
                    font-size: 18px;
                    font-weight: 600;
                    letter-spacing: 1px;
                }
                .health-header p {
                    color: #8892b0;
                    margin: 5px 0 0 0;
                    font-size: 12px;
                }
            </style>
            <div class="health-header">
                <h2>SERVICE HEALTH</h2>
                <p>RED Metrics: Rate - Errors - Duration | Real-time performance indicators</p>
            </div>
        </html>
    </row>

    <!-- Health Score + Key RED Metrics -->
    <row>
        <panel>
            <title>HEALTH SCORE</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval latency_ms=tonumber(request_time)*1000, status=tonumber(http_status)
| stats count as total, sum(eval(if(status&gt;=500, 1, 0))) as server_errors, sum(eval(if(status&gt;=400, 1, 0))) as all_errors,
    avg(latency_ms) as avg_latency,
    perc99(latency_ms) as p99_latency
| eval error_score=if(total&gt;0, max(0, 100-((server_errors/total)*500)-((all_errors/total)*50)), 100)
| eval latency_score=case(avg_latency&lt;50, 100, avg_latency&lt;100, 90, avg_latency&lt;200, 75, avg_latency&lt;500, 50, 1=1, 25)
| eval p99_score=case(p99_latency&lt;100, 100, p99_latency&lt;200, 85, p99_latency&lt;500, 65, p99_latency&lt;1000, 40, 1=1, 20)
| eval health_score=round((error_score*0.5)+(latency_score*0.3)+(p99_score*0.2), 0)
| fields health_score
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#DC4E41","#F8BE34","#53A051"]</option>
                <option name="rangeValues">[60,85]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Composite Score</option>
            </single>
        </panel>
        <panel>
            <title>THROUGHPUT</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| stats count as total
| eval rpm=round(total/60, 1)
| fields rpm
                    </query>
                    <earliest>-1m</earliest>
                    <latest>now</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#1a1a2e","#00D1B2"]</option>
                <option name="rangeValues">[0]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Requests/min (live)</option>
            </single>
        </panel>
        <panel>
            <title>ERROR RATE</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| stats count as total, sum(eval(if(tonumber(http_status)&gt;=400, 1, 0))) as errors
| eval rate=if(total&gt;0, round((errors/total)*100, 2), 0)
| fields rate
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[1,5]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
                <option name="underLabel">All HTTP Errors</option>
            </single>
        </panel>
        <panel>
            <title>AVG LATENCY</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000
| stats avg(ms) as avg | eval avg=round(avg, 0) | fields avg
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[100,500]</option>
                <option name="unit">ms</option>
                <option name="useColors">1</option>
                <option name="underLabel">Mean Response</option>
            </single>
        </panel>
        <panel>
            <title>P95 LATENCY</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000
| stats perc95(ms) as p95 | eval p95=round(p95, 0) | fields p95
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[200,1000]</option>
                <option name="unit">ms</option>
                <option name="useColors">1</option>
                <option name="underLabel">95th Percentile</option>
            </single>
        </panel>
        <panel>
            <title>APDEX</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000
| eval s=if(ms&lt;=100, 1, 0), t=if(ms&gt;100 AND ms&lt;=400, 1, 0)
| stats sum(s) as sat, sum(t) as tol, count
| eval apdex=round((sat+(tol/2))/count, 2) | fields apdex
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#DC4E41","#F8BE34","#53A051"]</option>
                <option name="rangeValues">[0.7,0.9]</option>
                <option name="useColors">1</option>
                <option name="underLabel">User Satisfaction</option>
            </single>
        </panel>
    </row>

    <!-- Error Breakdown -->
    <row>
        <panel>
            <title>5XX ERRORS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="nginx:access:json" http_status&gt;=500 | stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[1,10]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Server Errors</option>
            </single>
        </panel>
        <panel>
            <title>4XX ERRORS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="nginx:access:json" http_status&gt;=400 http_status&lt;500 | stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[50,200]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Client Errors</option>
            </single>
        </panel>
        <panel>
            <title>API EXCEPTIONS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="bookingapp:api:json" (level="error" OR level="fatal") | stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[1,10]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Backend Errors</option>
            </single>
        </panel>
        <panel>
            <title>CONTAINERS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" running=1 | stats dc(container)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#DC4E41","#53A051"]</option>
                <option name="rangeValues">[1]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Running</option>
            </single>
        </panel>
        <panel>
            <title>HOST CPU</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="cpu_metrics" | stats latest(cpu_percent) as cpu | eval cpu=round(cpu,0)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
                <option name="underLabel">Usage</option>
            </single>
        </panel>
        <panel>
            <title>HOST MEMORY</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="memory_metrics" | stats latest(mem_percent) as mem | eval mem=round(mem,0)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
                <option name="underLabel">Usage</option>
            </single>
        </panel>
    </row>

    <!-- ============================================================ -->
    <!-- SECTION 2: REAL-TIME PERFORMANCE TRENDS                     -->
    <!-- ============================================================ -->
    <row>
        <html>
            <div class="health-header">
                <h2>PERFORMANCE TRENDS</h2>
                <p>Request throughput, latency distribution, and error patterns over time</p>
            </div>
        </html>
    </row>

    <!-- Throughput with Error Overlay + Latency Percentiles -->
    <row>
        <panel>
            <title>THROUGHPUT &amp; ERRORS</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval is_error=if(tonumber(http_status)&gt;=400, 1, 0)
| timechart span=1m count as "Requests", sum(is_error) as "Errors"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">column</option>
                <option name="charting.chart.overlayFields">Errors</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Requests": "#00D1B2", "Errors": "#DC4E41"}</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="charting.axisTitleY.text">Count</option>
                <option name="height">280</option>
            </chart>
        </panel>
        <panel>
            <title>LATENCY PERCENTILES</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000
| timechart span=1m perc50(ms) as "P50", perc90(ms) as "P90", perc95(ms) as "P95", perc99(ms) as "P99"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"P50": "#53A051", "P90": "#6699CC", "P95": "#F8BE34", "P99": "#DC4E41"}</option>
                <option name="charting.axisTitleY.text">Latency (ms)</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="height">280</option>
            </chart>
        </panel>
    </row>

    <!-- Response Time Distribution + Status Codes -->
    <row>
        <panel>
            <title>RESPONSE TIME DISTRIBUTION</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000
| eval bucket=case(
    ms&lt;5, "0-5ms",
    ms&lt;10, "5-10ms",
    ms&lt;25, "10-25ms",
    ms&lt;50, "25-50ms",
    ms&lt;100, "50-100ms",
    ms&lt;250, "100-250ms",
    ms&lt;500, "250-500ms",
    ms&lt;1000, "500ms-1s", 1=1, "&gt;1s"
)
| stats count by bucket
| eval sort=case(bucket="0-5ms",1,bucket="5-10ms",2,bucket="10-25ms",3,bucket="25-50ms",4,bucket="50-100ms",5,bucket="100-250ms",6,bucket="250-500ms",7,bucket="500ms-1s",8,1=1,9)
| sort sort | fields - sort
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">bar</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"count": "#7C4DFF"}</option>
                <option name="charting.axisTitleX.text">Response Time</option>
                <option name="charting.axisTitleY.text">Requests</option>
                <option name="height">250</option>
            </chart>
        </panel>
        <panel>
            <title>HTTP STATUS BREAKDOWN</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval status_group=case(
    tonumber(http_status)&lt;300, "2xx Success",
    tonumber(http_status)&lt;400, "3xx Redirect",
    tonumber(http_status)&lt;500, "4xx Client", tonumber(http_status)&gt;=500, "5xx Server", 1=1, "Unknown"
)
| timechart span=5m count by status_group
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">area</option>
                <option name="charting.chart.stackMode">stacked</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"2xx Success": "#53A051", "3xx Redirect": "#6699CC", "4xx Client": "#F8BE34", "5xx Server": "#DC4E41"}</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="height">250</option>
            </chart>
        </panel>
    </row>

    <!-- ============================================================ -->
    <!-- SECTION 3: ENDPOINT PERFORMANCE                              -->
    <!-- ============================================================ -->
    <row>
        <html>
            <div class="health-header">
                <h2>ENDPOINT PERFORMANCE</h2>
                <p>Top endpoints by volume, slowest transactions, and error hotspots</p>
            </div>
        </html>
    </row>

    <row>
        <panel>
            <title>TOP ENDPOINTS (by requests)</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=tonumber(request_time)*1000, err=if(tonumber(http_status)&gt;=400,1,0)
| stats count as reqs, avg(ms) as avg, perc95(ms) as p95, sum(err) as errors by uri
| eval err_pct=round((errors/reqs)*100,1)."%"
| eval avg=round(avg,0)."ms", p95=round(p95,0)."ms"
| sort -reqs | head 10
| rename uri as "Endpoint", reqs as "Requests", avg as "Avg", p95 as "P95", err_pct as "Errors"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="drilldown">row</option>
                <option name="count">10</option>
                <format type="color" field="Errors">
                    <colorPalette type="expression">if(tonumber(replace(value,"%",""))&gt;5,"#DC4E41",if(tonumber(replace(value,"%",""))&gt;1,"#F8BE34","#53A051"))</colorPalette>
                </format>
                <drilldown>
                    <link target="_blank">02-endpoints?form.endpoint=$row.Endpoint$</link>
                </drilldown>
            </table>
        </panel>
        <panel>
            <title>SLOWEST TRANSACTIONS</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json"
| eval ms=round(tonumber(request_time)*1000,0)
| eval time=strftime(_time,"%H:%M:%S")
| sort -ms | head 10
| table time, method, uri, http_status, ms
| rename time as "Time", method as "Method", uri as "Endpoint", http_status as "Status", ms as "Latency (ms)"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="drilldown">row</option>
                <option name="count">10</option>
                <format type="color" field="Latency (ms)">
                    <colorPalette type="minMidMax" minColor="#53A051" midColor="#F8BE34" maxColor="#DC4E41"></colorPalette>
                    <scale type="minMidMax" midValue="100"></scale>
                </format>
                <format type="color" field="Status">
                    <colorPalette type="expression">if(tonumber(value)&gt;=500,"#DC4E41",if(tonumber(value)&gt;=400,"#F8BE34","#53A051"))</colorPalette>
                </format>
                <drilldown>
                    <link target="_blank">06-traces?form.request_id=$row.Endpoint$</link>
                </drilldown>
            </table>
        </panel>
    </row>

    <!-- ============================================================ -->
    <!-- SECTION 4: INFRASTRUCTURE &amp; DEPENDENCIES                   -->
    <!-- ============================================================ -->
    <row>
        <html>
            <div class="health-header">
                <h2>INFRASTRUCTURE &amp; DEPENDENCIES</h2>
                <p>Backend services, load balancing, and resource utilization</p>
            </div>
        </html>
    </row>

    <row>
        <panel>
            <title>BACKEND LATENCY (by server)</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json" upstream_addr!="-"
| eval upstream_ms=tonumber(upstream_response_time)*1000
| timechart span=1m avg(upstream_ms) as "Avg Backend" by upstream_addr limit=5
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.axisTitleY.text">Latency (ms)</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="height">250</option>
            </chart>
        </panel>
        <panel>
            <title>LOAD DISTRIBUTION</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json" upstream_addr!="-"
| stats count by upstream_addr | sort -count
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">pie</option>
                <option name="charting.drilldown">none</option>
                <option name="height">250</option>
            </chart>
        </panel>
    </row>

    <row>
        <panel>
            <title>SERVICE STATUS</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="docker_metrics" metric_type="docker_status"
| eval service=case(
    match(container, "api"), "API",
    match(container, "web"), "Web",
    match(container, "nginx"), "NGINX",
    match(container, "postgres"), "PostgreSQL",
    match(container, "redis"), "Redis", 1=1, container
)
| stats latest(running) as is_running, latest(health) as health by container, service
| eval status_icon=if(is_running=1, "Running", "Stopped")
| eval health_status=coalesce(health, if(is_running=1, "healthy", "unhealthy"))
| where is_running=1
| table service, container, status_icon, health_status
| sort service
| rename service as "Service", container as "Container", status_icon as "Status", health_status as "Health"
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="drilldown">none</option>
                <option name="count">15</option>
                <format type="color" field="Status">
                    <colorPalette type="map">{"Running": #53A051, "Stopped": #DC4E41}</colorPalette>
                </format>
                <format type="color" field="Health">
                    <colorPalette type="map">{"healthy": #53A051, "unhealthy": #DC4E41, "starting": #F8BE34}</colorPalette>
                </format>
            </table>
        </panel>
        <panel>
            <title>CONTAINER RESOURCES</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="docker_metrics" metric_type="docker"
| stats latest(cpu_percent) as cpu, latest(mem_percent) as mem by container
| eval cpu=round(cpu,1), mem=round(mem,1)
| sort -cpu | head 10
| rename container as "Container", cpu as "CPU %", mem as "Memory %"
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="drilldown">none</option>
                <format type="color" field="CPU %">
                    <colorPalette type="expression">if(value&gt;50,"#DC4E41",if(value&gt;20,"#F8BE34","#53A051"))</colorPalette>
                </format>
                <format type="color" field="Memory %">
                    <colorPalette type="expression">if(value&gt;80,"#DC4E41",if(value&gt;50,"#F8BE34","#53A051"))</colorPalette>
                </format>
            </table>
        </panel>
    </row>

    <!-- ============================================================ -->
    <!-- SECTION 5: ERRORS &amp; ISSUES                                  -->
    <!-- ============================================================ -->
    <row>
        <html>
            <div class="health-header">
                <h2>ERRORS &amp; ISSUES</h2>
                <p>Recent errors, affected endpoints, and error patterns</p>
            </div>
        </html>
    </row>

    <row>
        <panel>
            <title>HTTP ERROR HOTSPOTS</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="nginx:access:json" http_status&gt;=400
| stats count as errors, latest(_time) as last_seen by method, uri, http_status
| eval last_seen=strftime(last_seen, "%H:%M:%S")
| sort -errors | head 10
| rename method as "Method", uri as "Endpoint", http_status as "Status", errors as "Count", last_seen as "Last Seen"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="drilldown">row</option>
                <option name="count">10</option>
                <format type="color" field="Status">
                    <colorPalette type="expression">if(tonumber(value)&gt;=500,"#DC4E41","#F8BE34")</colorPalette>
                </format>
                <drilldown>
                    <link target="_blank">02-endpoints?form.endpoint=$row.Endpoint$</link>
                </drilldown>
            </table>
        </panel>
        <panel>
            <title>RECENT API EXCEPTIONS</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="bookingapp:api:json" (level="error" OR level="fatal" OR level="warn")
| eval time=strftime(_time, "%H:%M:%S")
| eval msg=substr(message, 1, 60)
| eval ctx=coalesce('metadata.context', "-")
| table time, level, ctx, msg
| sort -_time | head 10
| rename time as "Time", level as "Level", ctx as "Context", msg as "Message"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="drilldown">none</option>
                <option name="wrap">true</option>
                <option name="count">10</option>
                <format type="color" field="Level">
                    <colorPalette type="map">{"error": #DC4E41, "fatal": #B83C32, "warn": #F8BE34}</colorPalette>
                </format>
            </table>
        </panel>
    </row>

    <!-- ============================================================ -->
    <!-- SECTION 6: DEPENDENCY HEALTH                                 -->
    <!-- ============================================================ -->
    <row>
        <html>
            <div class="health-header">
                <h2>DEPENDENCY HEALTH</h2>
                <p>Database, cache, and external service status</p>
            </div>
        </html>
    </row>

    <row>
        <panel>
            <title>POSTGRESQL</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="postgresql:log" earliest=-5m
| stats count as events, sum(eval(if(match(_raw,"ERROR|FATAL"),1,0))) as errors
| eval status=case(events=0, "No Data", errors&gt;0, "Errors", 1=1, "Healthy")
| fields status
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#DC4E41","#53A051"]</option>
                <option name="useColors">0</option>
                <option name="underLabel">Database</option>
            </single>
        </panel>
        <panel>
            <title>DB CONNECTIONS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="postgresql:log" "connection received" earliest=-5m | stats count</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051"]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Last 5 min</option>
            </single>
        </panel>
        <panel>
            <title>REDIS</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="redis:log" earliest=-5m
| stats count as events, sum(eval(if(match(_raw,"#"),1,0))) as warnings
| eval status=case(events=0, "No Data", warnings&gt;5, "Warnings", 1=1, "Healthy")
| fields status
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="useColors">0</option>
                <option name="underLabel">Cache</option>
            </single>
        </panel>
        <panel>
            <title>REDIS KEYS</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="redis:log" "DB 0:" | rex "(?&lt;keys&gt;\d+) keys" | stats latest(keys)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051"]</option>
                <option name="useColors">1</option>
                <option name="underLabel">Stored</option>
            </single>
        </panel>
        <panel>
            <title>DISK USAGE</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="disk_metrics" mount="/" | stats latest(use_percent) as disk | eval disk=round(disk,0)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
                <option name="underLabel">Root Partition</option>
            </single>
        </panel>
        <panel>
            <title>LOAD AVG</title>
            <single>
                <search>
                    <query>index=bookingapp sourcetype="cpu_metrics" | stats latest(load_1) as load | eval load=round(load,2)</query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[4,8]</option>
                <option name="useColors">1</option>
                <option name="underLabel">1 min avg</option>
            </single>
        </panel>
    </row>
</form>
