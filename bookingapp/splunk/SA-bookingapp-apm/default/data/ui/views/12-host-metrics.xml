<form version="1.1" theme="dark">
    <label>HOST METRICS</label>
    <description>CPU - Memory - Disk - Network - System Health</description>

    <fieldset submitButton="false" autoRun="true">
        <input type="time" token="time" searchWhenChanged="true">
            <label>TIME RANGE</label>
            <default>
                <earliest>-1h</earliest>
                <latest>now</latest>
            </default>
        </input>
    </fieldset>

    <!-- Key Metrics -->
    <row>
        <panel>
            <title>CPU USAGE</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="cpu_metrics" metric_type="cpu"
| stats latest(cpu_percent) as cpu
| eval cpu=round(cpu, 1)
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>MEMORY USAGE</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="memory_metrics" metric_type="memory"
| stats latest(mem_percent) as mem
| eval mem=round(mem, 1)
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>DISK USAGE</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="disk_metrics" metric_type="disk" mount="/"
| stats latest(use_percent) as disk
| eval disk=round(disk, 1)
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[70,90]</option>
                <option name="unit">%</option>
                <option name="useColors">1</option>
            </single>
        </panel>
        <panel>
            <title>LOAD AVERAGE (1m)</title>
            <single>
                <search>
                    <query>
index=bookingapp sourcetype="cpu_metrics" metric_type="cpu"
| stats latest(load_1) as load
| eval load=round(load, 2)
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="colorMode">block</option>
                <option name="rangeColors">["#53A051","#F8BE34","#DC4E41"]</option>
                <option name="rangeValues">[4,8]</option>
                <option name="useColors">1</option>
            </single>
        </panel>
    </row>

    <!-- CPU Over Time -->
    <row>
        <panel>
            <title>CPU USAGE OVER TIME</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="cpu_metrics" metric_type="cpu"
| timechart span=1m avg(cpu_percent) as "CPU %"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">area</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"CPU %": "#7C4DFF"}</option>
                <option name="charting.axisTitleY.text">%</option>
                <option name="height">250</option>
            </chart>
        </panel>
        <panel>
            <title>MEMORY USAGE OVER TIME</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="memory_metrics" metric_type="memory"
| timechart span=1m avg(mem_percent) as "Memory %"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">area</option>
                <option name="charting.chart.nullValueMode">zero</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"Memory %": "#00D1B2"}</option>
                <option name="charting.axisTitleY.text">%</option>
                <option name="height">250</option>
            </chart>
        </panel>
    </row>

    <!-- Load Average & Disk -->
    <row>
        <panel>
            <title>LOAD AVERAGE OVER TIME</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="cpu_metrics" metric_type="cpu"
| timechart span=1m avg(load_1) as "1 min", avg(load_5) as "5 min", avg(load_15) as "15 min"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"1 min": "#DC4E41", "5 min": "#F8BE34", "15 min": "#53A051"}</option>
                <option name="height">250</option>
            </chart>
        </panel>
        <panel>
            <title>DISK USAGE BY MOUNT</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="disk_metrics" metric_type="disk"
| stats latest(use_percent) as usage by mount
| sort -usage
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">bar</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.axisTitleY.text">Usage %</option>
                <option name="height">250</option>
            </chart>
        </panel>
    </row>

    <!-- Network -->
    <row>
        <panel>
            <title>NETWORK TRAFFIC BY INTERFACE</title>
            <chart>
                <search>
                    <query>
index=bookingapp sourcetype="network_metrics" metric_type="network" interface!="lo"
| stats latest(rx_mb) as rx_mb, latest(tx_mb) as tx_mb by interface
| eval total=rx_mb+tx_mb
| sort -total
| head 5
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="charting.chart">bar</option>
                <option name="charting.chart.stackMode">stacked</option>
                <option name="charting.drilldown">none</option>
                <option name="charting.fieldColors">{"rx_mb": "#6699CC", "tx_mb": "#FF6384"}</option>
                <option name="height">250</option>
            </chart>
        </panel>
        <panel>
            <title>TOP PROCESSES BY CPU</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="ps_metrics" metric_type="process"
| stats latest(cpu_percent) as cpu, latest(mem_percent) as mem by command
| sort -cpu
| head 10
| rename command as "Command", cpu as "CPU %", mem as "Memory %"
                    </query>
                    <earliest>-5m</earliest>
                    <latest>now</latest>
                </search>
                <option name="drilldown">none</option>
            </table>
        </panel>
    </row>

    <!-- System Logs -->
    <row>
        <panel>
            <title>SYSTEM LOGS</title>
            <table>
                <search>
                    <query>
index=bookingapp sourcetype="syslog"
| rex field=_raw "^\w+\s+\d+\s+\d+:\d+:\d+\s+(?&lt;hostname&gt;\S+)\s+(?&lt;process&gt;[^\[]+)"
| eval time=strftime(_time, "%H:%M:%S")
| eval msg=substr(_raw, 1, 200)
| table time, hostname, process, msg
| sort -_time
| head 50
| rename time as "Time", hostname as "Host", process as "Process", msg as "Message"
                    </query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                </search>
                <option name="drilldown">none</option>
                <option name="wrap">true</option>
            </table>
        </panel>
    </row>
</form>
