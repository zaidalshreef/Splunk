# BookingApp APM Saved Searches and Alerts

# Alert: Service Down
[Service Down Alert]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" (container="*api*" OR container="*nginx*" OR container="*redis*" OR container="*postgres*" OR container="*web*") running=0 | stats count by container, status | where count > 0
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 4
alert.suppress = 1
alert.suppress.period = 15m
alert.suppress.fields = container
alert.track = 1
alert_condition = search count > 0
description = Alerts when a critical BookingApp service container is not running

# Alert: High Error Rate
[High Error Rate Alert]
search = index=bookingapp sourcetype="nginx:access:json" | stats count as total, sum(eval(if(tonumber(http_status)>=500,1,0))) as errors | eval error_rate=if(total>0, (errors/total)*100, 0) | where error_rate > 5
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 15m
alert.track = 1
alert_condition = search error_rate > 5
description = Alerts when HTTP 5xx error rate exceeds 5%

# Alert: High Latency
[High Latency Alert]
search = index=bookingapp sourcetype="nginx:access:json" | eval latency_ms=tonumber(request_time)*1000 | stats avg(latency_ms) as avg_latency, p95(latency_ms) as p95_latency | where p95_latency > 1000
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */5 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 2
alert.suppress = 1
alert.suppress.period = 15m
alert.track = 1
alert_condition = search p95_latency > 1000
description = Alerts when P95 latency exceeds 1000ms

# Alert: Redis Down
[Redis Down Alert]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" container="*redis*" | stats latest(running) as is_running | where is_running=0
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */2 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 5
alert.suppress = 1
alert.suppress.period = 10m
alert.track = 1
alert_condition = search is_running=0
description = Critical alert when Redis cache is down

# Alert: PostgreSQL Down
[PostgreSQL Down Alert]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" container="*postgres*" | stats latest(running) as is_running | where is_running=0
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */2 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 5
alert.suppress = 1
alert.suppress.period = 10m
alert.track = 1
alert_condition = search is_running=0
description = Critical alert when PostgreSQL database is down

# Alert: All API Instances Down
[All API Instances Down Alert]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" container="*api*" | stats sum(running) as running_apis | where running_apis=0
dispatch.earliest_time = -5m
dispatch.latest_time = now
cron_schedule = */2 * * * *
enableSched = 1
is_scheduled = 1
alert.severity = 5
alert.suppress = 1
alert.suppress.period = 10m
alert.track = 1
alert_condition = search running_apis=0
description = Critical alert when all API instances are down

# Saved Search: Service Health Summary
[Service Health Summary]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" | stats latest(running) as is_running, latest(status) as status, latest(health) as health by container | eval state = if(is_running=1, "Running", "Stopped") | sort -is_running, container
dispatch.earliest_time = -15m
dispatch.latest_time = now
description = Shows current health status of all containers

# Saved Search: Availability Report
[Service Availability Report]
search = index=bookingapp sourcetype="docker_metrics" metric_type="docker_status" (container="*api*" OR container="*nginx*" OR container="*redis*" OR container="*postgres*" OR container="*web*") | eval service = case(match(container, "api"), "API", match(container, "web"), "Frontend", match(container, "nginx"), "NGINX", match(container, "redis"), "Redis", match(container, "postgres"), "PostgreSQL", 1=1, "Other") | stats count as total_checks, sum(running) as up_checks by service | eval availability_pct = round((up_checks/total_checks)*100, 2) | table service, availability_pct
dispatch.earliest_time = -24h
dispatch.latest_time = now
description = Daily availability report for all services

