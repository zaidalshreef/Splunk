# =============================================================================
# Splunk Data Parsing Configuration
# =============================================================================
# Place this file in: /opt/splunkforwarder/etc/system/local/props.conf
# And on the indexer: /opt/splunk/etc/system/local/props.conf

# =============================================================================
# Docker Metrics (Container Health, Swarm, Stats)
# =============================================================================

[docker:metrics]
KV_MODE = json
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%SZ
TIME_PREFIX = "timestamp":"
MAX_TIMESTAMP_LOOKAHEAD = 30

[docker:container:json]
SHOULD_LINEMERGE = false
TIME_PREFIX = "time":"
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 40
KV_MODE = json
LINE_BREAKER = ([\r\n]+)
TRUNCATE = 0
EXTRACT-container_log = "log":"(?<container_log>.+?)",
EXTRACT-stream = "stream":"(?<stream>[^"]+)"

[dokploy:app]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
TIME_FORMAT = %Y-%m-%d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 30
LINE_BREAKER = ([\r\n]+)

# =============================================================================
# Docker Container JSON Logs
# =============================================================================

[docker:container:json]
SHOULD_LINEMERGE = false
TIME_PREFIX = "time":"
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%9N
TRUNCATE = 0
LINE_BREAKER = ([\r\n]+)
MAX_TIMESTAMP_LOOKAHEAD = 40
KV_MODE = json

# Extract container name from log field
EXTRACT-container = "log":"(?<log_message>.+)"

# =============================================================================
# Docker Stats (Legacy)
# =============================================================================

[docker:stats]
KV_MODE = json
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%S

# =============================================================================
# Docker Swarm Events (Legacy)
# =============================================================================

[docker:swarm:node]
KV_MODE = json
SHOULD_LINEMERGE = false

[docker:swarm:service]
KV_MODE = json
SHOULD_LINEMERGE = false

[docker:container:status]
KV_MODE = json
SHOULD_LINEMERGE = false

# =============================================================================
# Traefik Access Logs
# =============================================================================

[traefik:access]
KV_MODE = json
SHOULD_LINEMERGE = false
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
TIME_PREFIX = "time":"
MAX_TIMESTAMP_LOOKAHEAD = 30

# =============================================================================
# Linux Syslog
# =============================================================================

[syslog]
TIME_FORMAT = %b %d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 20
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)

# Extract common syslog fields
EXTRACT-syslog = ^(?<syslog_timestamp>\w{3}\s+\d+\s+\d+:\d+:\d+)\s+(?<syslog_host>\S+)\s+(?<syslog_process>\S+?)(\[(?<syslog_pid>\d+)\])?:\s+(?<syslog_message>.+)

# =============================================================================
# Linux Secure/Auth Log
# =============================================================================

[linux_secure]
TIME_FORMAT = %b %d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 20
SHOULD_LINEMERGE = false

# Extract SSH authentication fields
EXTRACT-ssh_auth = Accepted\s+(?<auth_method>\S+)\s+for\s+(?<user>\S+)\s+from\s+(?<src_ip>\d+\.\d+\.\d+\.\d+)\s+port\s+(?<src_port>\d+)
EXTRACT-ssh_failed = Failed\s+(?<auth_method>\S+)\s+for\s+(?<user>\S+)\s+from\s+(?<src_ip>\d+\.\d+\.\d+\.\d+)\s+port\s+(?<src_port>\d+)
EXTRACT-ssh_invalid = Invalid user\s+(?<user>\S+)\s+from\s+(?<src_ip>\d+\.\d+\.\d+\.\d+)

# =============================================================================
# Linux Kernel Log
# =============================================================================

[linux_kernel]
TIME_FORMAT = %b %d %H:%M:%S
MAX_TIMESTAMP_LOOKAHEAD = 20
SHOULD_LINEMERGE = false

# Extract kernel log fields
EXTRACT-kernel = ^(?<kernel_timestamp>\w{3}\s+\d+\s+\d+:\d+:\d+)\s+(?<host>\S+)\s+kernel:\s+\[?\s*(?<kernel_time>[\d.]+)\]?\s*(?<kernel_message>.+)
