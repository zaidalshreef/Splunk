<form version="1.1" theme="dark">
    <label> Docker Swarm Command Center</label>
    <description>Container Health, Performance Metrics, Swarm Orchestration, and Resource Utilization</description>

    <!-- ============================================== -->
    <!-- GLOBAL SETTINGS -->
    <!-- ============================================== -->
    <fieldset submitButton="true" autoRun="true">
        <input type="time" token="time" searchWhenChanged="true">
            <label>Time Range</label>
            <default>
                <earliest>-1h</earliest>
                <latest>now</latest>
            </default>
        </input>
        <input type="dropdown" token="host_filter" searchWhenChanged="true">
            <label>Host</label>
            <choice value="*">All Hosts</choice>
            <default>*</default>
            <initialValue>*</initialValue>
            <fieldForLabel>host</fieldForLabel>
            <fieldForValue>host</fieldForValue>
            <search>
                <query>index=docker | stats count by host</query>
                <earliest>$time.earliest$</earliest>
                <latest>$time.latest$</latest>
            </search>
        </input>
        <input type="dropdown" token="container_filter" searchWhenChanged="true">
            <label>Container</label>
            <choice value="*">All Containers</choice>
            <default>*</default>
            <initialValue>*</initialValue>
            <fieldForLabel>container_name</fieldForLabel>
            <fieldForValue>container_name</fieldForValue>
            <search>
                <query>index=docker sourcetype="docker:metrics" event_type="docker_container" container_name=* 
| stats count by container_name</query>
                <earliest>$time.earliest$</earliest>
                <latest>$time.latest$</latest>
            </search>
        </input>
    </fieldset>

    <!-- ============================================== -->
    <!-- KEY METRICS ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title> Healthy Containers</title>
            <single>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup container_id sortby -_time
| search health="healthy" OR health="null" status="running"
| stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">all</option>
                <option name="underLabel">Running</option>
                <option name="useColors">0</option>
                <option name="numberPrecision">0</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20health%3Dhealthy&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </single>
        </panel>
        <panel>
            <title> Unhealthy/Stopped</title>
            <single>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup container_id sortby -_time
| search (health="unhealthy" OR status!="running")
| stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">all</option>
                <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
                <option name="rangeValues">[0,1]</option>
                <option name="underLabel">Need Attention</option>
                <option name="useColors">1</option>
                <option name="numberPrecision">0</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20unhealthy&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </single>
        </panel>
        <panel>
            <title> Swarm Nodes</title>
            <single>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_swarm_node" host=$host_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup node_id sortby -_time
| search status="ready"
| stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">all</option>
                <option name="underLabel">Ready Nodes</option>
                <option name="useColors">0</option>
                <option name="numberPrecision">0</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20event_type%3D%22docker_swarm_node%22&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </single>
        </panel>
        <panel>
            <title> Swarm Services</title>
            <single>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_swarm_service" host=$host_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup service_id sortby -_time
| stats count</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">all</option>
                <option name="underLabel">Active Services</option>
                <option name="useColors">0</option>
                <option name="numberPrecision">0</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20event_type%3D%22docker_swarm_service%22&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </single>
        </panel>
        <panel>
            <title> Avg Restart Count</title>
            <single>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup container_id sortby -_time
| stats avg(restart_count) as avg_restarts
| eval avg_restarts=round(avg_restarts, 1)</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="drilldown">none</option>
                <option name="rangeColors">["0x53a051","0xf8be34","0xf1813f","0xdc4e41"]</option>
                <option name="rangeValues">[0,5,10,20]</option>
                <option name="underLabel">Restarts</option>
                <option name="useColors">1</option>
                <option name="numberPrecision">0.0</option>
            </single>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- HEALTH MONITORING ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Container Health Distribution (Real-Time)</title>
            <chart>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| eval health=if(isnull(health) OR health="null", "no_healthcheck", health)
| eval status_health=status."-".health
| timechart span=2m count by status_health limit=15</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">area</option>
                <option name="charting.chart.stackMode">stacked</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.text">Containers</option>
                <option name="charting.legend.placement">bottom</option>
                <option name="charting.fieldColors">{"running-healthy":"#53a051","running-no_healthcheck":"#6DB7C6","running-starting":"#f8be34","running-unhealthy":"#dc4e41","exited-null":"#6c757d"}</option>
                <option name="drilldown">all</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20earliest%3D$click.value$&amp;latest=$click.value2$</link>
                </drilldown>
            </chart>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- RESOURCE UTILIZATION ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Container CPU Usage % (Real-Time)</title>
            <chart>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| eval cpu_percent_clean=replace(cpu_percent, "%", "")
| eval cpu_val=tonumber(cpu_percent_clean)
| eval container_short=if(len(container_name)&gt;30, substr(container_name,1,27)."...", container_name)
| timechart span=2m avg(cpu_val) as cpu_avg by container_short limit=10</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.text">CPU %</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.chart.showMarkers">true</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="drilldown">all</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Astats%22%20container_name%3D$click.name2$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <title>Container Memory Usage % (Real-Time)</title>
            <chart>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| eval mem_percent_clean=replace(mem_percent, "%", "")
| eval mem_val=tonumber(mem_percent_clean)
| eval container_short=if(len(container_name)&gt;30, substr(container_name,1,27)."...", container_name)
| timechart span=2m avg(mem_val) as mem_avg by container_short limit=10</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">line</option>
                <option name="charting.axisTitleX.visibility">collapsed</option>
                <option name="charting.axisTitleY.text">Memory %</option>
                <option name="charting.legend.placement">right</option>
                <option name="charting.chart.showMarkers">true</option>
                <option name="charting.chart.nullValueMode">connect</option>
                <option name="drilldown">all</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Astats%22%20container_name%3D$click.name2$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </chart>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- SWARM ORCHESTRATION ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Swarm Node Health</title>
            <table>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_swarm_node" host=$host_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup node_id sortby -_time
| eval health_icon=case( status="ready" AND availability="active", "", status="ready" AND availability!="active", "ðŸŸ¡", 1=1, ""
)
| eval manager=if(isnotnull(manager_status) AND manager_status!="null", "Yes ("+manager_status+")", "No")
| table health_icon, hostname, status, availability, manager, engine_version
| rename health_icon as "Status", hostname as "Hostname", status as "State", availability as "Availability", manager as "Manager", engine_version as "Docker Version"
| sort Hostname</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="count">10</option>
                <option name="drilldown">cell</option>
                <option name="wrap">true</option>
                <option name="rowNumbers">false</option>
                <format type="color" field="State">
                    <colorPalette type="map">{"ready":#53a051,"down":#dc4e41}</colorPalette>
                </format>
                <format type="color" field="Availability">
                    <colorPalette type="map">{"active":#53a051,"drain":#f8be34,"pause":#f1813f}</colorPalette>
                </format>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20hostname%3D$row.Hostname$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </table>
        </panel>
        <panel>
            <title>Swarm Services Status</title>
            <table>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_swarm_service" host=$host_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup service_id sortby -_time
| eval replicas_status=replicas_running."/".replicas_desired
| eval health_icon=case( replicas_running=replicas_desired, "",
    replicas_running&gt;0 AND replicas_running&lt;replicas_desired, "ðŸŸ¡", replicas_running=0, "", 1=1, ""
)
| eval image_short=mvindex(split(image, "/"), -1)
| table health_icon, service_name, replicas_status, image_short
| rename health_icon as "Status", service_name as "Service Name", replicas_status as "Replicas (Running/Desired)", image_short as "Image"
| sort "Service Name"</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="count">10</option>
                <option name="drilldown">cell</option>
                <option name="wrap">true</option>
                <option name="rowNumbers">false</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20service_name%3D%22$row.Service Name$%22&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </table>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- CONTAINER DETAILS ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Container Inventory (Latest Status)</title>
            <table>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup container_id sortby -_time
| eval health_icon=case( status="running" AND (health="healthy" OR health="null" OR isnull(health)), "", status="running" AND health="starting", "ðŸŸ¡", status="running" AND health="unhealthy", "", status!="running", "", 1=1, ""
)
| eval health_display=if(isnull(health) OR health="null", "N/A", health)
| eval uptime=round((now()-strptime(started_at, "%Y-%m-%dT%H:%M:%S"))/3600, 1)
| eval image_short=mvindex(split(image, "/"), -1)
| table health_icon, container_name, status, health_display, restart_count, uptime, host, image_short
| rename health_icon as "St", container_name as "Container Name", status as "Status", health_display as "Health", restart_count as "Restarts", uptime as "Uptime (hrs)", host as "Host", image_short as "Image"
| sort -Restarts</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="count">20</option>
                <option name="drilldown">cell</option>
                <option name="wrap">true</option>
                <option name="rowNumbers">true</option>
                <option name="dataOverlayMode">none</option>
                <format type="color" field="Status">
                    <colorPalette type="map">{"running":#53a051,"exited":#6c757d,"created":#6DB7C6,"restarting":#f8be34,"paused":#f1813f,"dead":#dc4e41}</colorPalette>
                </format>
                <format type="color" field="Health">
                    <colorPalette type="map">{"healthy":#53a051,"starting":#f8be34,"unhealthy":#dc4e41,"N/A":#6c757d}</colorPalette>
                </format>
                <format type="color" field="Restarts">
                    <colorPalette type="minMidMax" minColor="#53a051" midColor="#f8be34" maxColor="#dc4e41"></colorPalette>
                    <scale type="minMidMax" minValue="0" midValue="10" maxValue="50"></scale>
                </format>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20container_name%3D%22$row.Container Name$%22&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </table>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- PERFORMANCE INSIGHTS ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Top 10 Containers by CPU Usage</title>
            <chart>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| eval cpu_percent_clean=replace(cpu_percent, "%", "")
| eval cpu_val=tonumber(cpu_percent_clean)
| eval container_short=if(len(container_name)&gt;30, substr(container_name,1,27)."...", container_name)
| stats avg(cpu_val) as avg_cpu by container_short
| sort -avg_cpu
| head 10
| eval avg_cpu=round(avg_cpu, 2)</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">bar</option>
                <option name="charting.axisTitleX.text">Average CPU %</option>
                <option name="charting.axisTitleY.text">Container</option>
                <option name="charting.chart.showDataLabels">all</option>
                <option name="charting.seriesColors">[0x6DB7C6]</option>
                <option name="drilldown">all</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Astats%22%20container_name%3D$click.name2$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </chart>
        </panel>
        <panel>
            <title>Top 10 Containers by Memory Usage</title>
            <chart>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_container" host=$host_filter$ container_name=$container_filter$ earliest=$time.earliest$ latest=$time.latest$
| eval mem_percent_clean=replace(mem_percent, "%", "")
| eval mem_val=tonumber(mem_percent_clean)
| eval container_short=if(len(container_name)&gt;30, substr(container_name,1,27)."...", container_name)
| stats avg(mem_val) as avg_mem by container_short
| sort -avg_mem
| head 10
| eval avg_mem=round(avg_mem, 2)</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="charting.chart">bar</option>
                <option name="charting.axisTitleX.text">Average Memory %</option>
                <option name="charting.axisTitleY.text">Container</option>
                <option name="charting.chart.showDataLabels">all</option>
                <option name="charting.seriesColors">[0xAC8EC1]</option>
                <option name="drilldown">all</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Astats%22%20container_name%3D$click.name2$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </chart>
        </panel>
    </row>

    <!-- ============================================== -->
    <!-- DAEMON INFO ROW -->
    <!-- ============================================== -->
    <row>
        <panel>
            <title>Docker Daemon Statistics by Host</title>
            <table>
                <search>
                    <query>index=docker sourcetype="docker:metrics" event_type="docker_daemon" host=$host_filter$ earliest=$time.earliest$ latest=$time.latest$
| dedup host sortby -_time
| table host, containers_total, containers_running, containers_paused, containers_stopped, images
| rename host as "Host", containers_total as "Total", containers_running as "Running", containers_paused as "Paused", containers_stopped as "Stopped", images as "Images"
| sort Host</query>
                    <earliest>$time.earliest$</earliest>
                    <latest>$time.latest$</latest>
                    <refresh>30s</refresh>
                    <refreshType>delay</refreshType>
                </search>
                <option name="count">10</option>
                <option name="drilldown">cell</option>
                <option name="wrap">true</option>
                <option name="rowNumbers">false</option>
                <drilldown>
                    <link target="_blank">/app/search/search?q=index%3Ddocker%20sourcetype%3D%22docker%3Ametrics%22%20host%3D$row.Host$&amp;earliest=$time.earliest$&amp;latest=$time.latest$</link>
                </drilldown>
            </table>
        </panel>
    </row>

</form>

